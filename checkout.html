<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Thanh toán - Tiktok Trendy Shop</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
     :root {
      --max-w: 1200px; --bg-body: #121212; --bg-card: #242424; --bg-card-hover: #2c2c2c;
      --text-primary: #f1f1f1; --text-secondary: #a0a0a0; --accent: #fe2c55;
      --border-color: rgba(255, 255, 255, 0.08); --radius: 8px;
    }
    body { margin: 0; font-family: Inter, system-ui, Arial; background-color: var(--bg-body); color: var(--text-primary); }
    a { text-decoration: none; color: inherit; }
    
    main { max-width: 1000px; margin: 40px auto; display: flex; flex-direction: column; gap: 20px; }
    
    header.site-header {
      background: #000; border-bottom: 1px solid rgba(255,255,255,0.04);
      position: sticky; top:0; z-index:1200;
    }
    .header-container {
      max-width: 1200px; margin: 0 auto; padding: 12px 18px;
      display: flex; align-items: center; gap: 14px; flex-wrap: wrap;
    }
    .logo img { height: 56px; }

    /* Search */
    .search-box { position: relative; flex: 1 1 520px; max-width: 60vw; min-width: 160px }
    .search-icon {
      position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
      color: #605f5f; font-size: 1.05rem; pointer-events: none;
    }
    .search-input {
      width: 100%; height: 44px; padding: 10px 16px 10px 44px;
      border-radius: 999px; border: 1px solid #3e3e3f; background: #fff; color: #000;
    }

    /* Header Right */
    .header-right { display: flex; align-items: center; gap: 12px; margin-left: auto }
    .cart-btn { position: relative; padding: 8px; border-radius: 10px; }
    .cart-icon { width: 28px; height: 28px }
    .cart-badge {
      position: absolute; top: -6px; right: -6px;
      background: #fe2c55; color: #fff; min-width: 20px; height: 20px;
      border-radius: 50%; font-size: 0.75rem; display: flex; align-items: center; justify-content: center;
    }

    #userSection { display: flex; align-items: center; gap: 8px }
    .user-name {
      background: #fff; color: #000; padding: 6px 16px;
      border-radius: 20px; font-weight: 600
    }
    .logout-btn {
      background: transparent; border: 1px solid #fe2c55; color: #fe2c55;
      padding: 6px 12px; border-radius: 20px; font-weight: 600; cursor: pointer;
    }
    .logout-btn:hover { background: #fe2c55; color: #fff }
    .login-btn {
      background: transparent; border: 1px solid #fff; color: #fff;
      padding: 6px 16px; border-radius: 20px; font-weight: 600; cursor: pointer;
    }
    .login-btn:hover { background: #fff; color: #000 }

    /* Menu */
    nav.main-menu { width: 100%; order: 2; margin-top: 10px; display: flex; justify-content: center }
    .main-menu ul {
      display: flex; gap: 24px; list-style: none; margin: 0; padding: 6px 0;
      align-items: center; flex-wrap: wrap
    }
   .main-menu a { color: #fff; font-weight: 700; text-transform: uppercase; padding: 6px 8px }
    .main-menu a:hover { text-decoration: none; color: #fe2c55 !important }

    .brand-menu { position: relative }
    .brand-menu .submenu {
      display: none; position: absolute; left: 0; top: calc(100% + 8px); min-width: 180px;
      background: #000; color: #eef2f7; border-radius: 10px;
      box-shadow: 0 12px 36px rgba(15,23,36,0.08);
      overflow: hidden; z-index: 400;
      transform: translateY(-6px); opacity: 0;
      transition: opacity .12s, transform .12s; pointer-events: none
    }
    .brand-menu:hover .submenu,
    .brand-menu:focus-within .submenu {
      display: block; transform: translateY(0); opacity: 1; pointer-events: auto
    }
    .submenu li a {
      display: block; padding: 10px 14px; font-weight: 700; color: #eef2f7 !important
    }
    .submenu li a:hover { background: #292929; color: #fe2c55 !important }
    .checkout-section {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: var(--radius);
    }
    
    /* Address Section */
    .address-section { border-top: 3px solid var(--accent); padding: 20px 25px; }
    .address-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .address-header h2 { margin: 0; font-size: 1.2rem; color: var(--accent); }
    .address-header .change-btn { background: none; border: none; color: #ffa600; cursor: pointer; font-weight: 600; }
    .address-details p { margin: 5px 0; }

    /* Products Section */
    .products-header { display: grid; grid-template-columns: 3fr 1fr 1fr 1fr; gap: 20px; padding: 20px 25px; color: var(--text-secondary); }
    .product-list { padding: 0 25px; }
    .product-item { display: grid; grid-template-columns: 3fr 1fr 1fr 1fr; gap: 20px; align-items: center; padding: 20px 0; border-top: 1px solid var(--border-color); }
    .product-info { display: flex; align-items: center; gap: 15px; }
    .product-info img { width: 60px; height: 60px; border-radius: 8px; }
    .product-info .name { font-weight: 600; }
    .product-info .classification { font-size: 0.9rem; color: var(--text-secondary); }
    .text-center { text-align: center; }
    .text-right { text-align: right; }

    /* Payment & Summary Section */
    .section-title { padding: 20px 25px; font-size: 1.2rem; font-weight: 600; border-bottom: 1px solid var(--border-color); }
    .payment-options { padding: 20px 25px; display: flex; gap: 15px; }
    .payment-option {
        padding: 10px 15px; border: 1px solid var(--border-color); border-radius: 8px;
        cursor: pointer; font-weight: 600; transition: border-color 0.2s, color 0.2s;
    }
    .payment-option:hover { border-color: var(--accent); }
    .payment-option.active { border-color: var(--accent); color: var(--accent); }

    .order-options { padding: 0 25px; }
    .option-line { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; border-top: 1px solid var(--border-color); }
    .option-line .label { font-weight: 600; }
    .option-line .value { color: var(--text-secondary); }
    .option-line .action { color: #ffa600; cursor: pointer; font-weight: 600; }
    .free-shipping { color: #34d399; font-weight: 600; }

    .summary-section {
        padding: 20px 25px;
        border-top: 1px dashed var(--border-color);
    }
    .summary-line { display: flex; justify-content: space-between; margin-bottom: 15px; }
    .summary-line .label { color: var(--text-secondary); font-size: 1rem; }
    .summary-line .value { font-weight: 600; font-size: 1.1rem; }
    
    .place-order-section {
        background-color: #1e1e1e;
        border-top: 1px solid var(--border-color);
        display: flex;
        justify-content: flex-end;
        align-items: center;
        padding: 20px 25px;
        gap: 25px;
    }
    .total-payable .label { font-size: 1rem; color: var(--text-primary); }
    .total-payable .value { font-size: 1.8rem; font-weight: 700; color: var(--accent); }
    .place-order-btn {
        background: var(--accent); color: white; padding: 15px 40px; border-radius: 8px;
        border: none; font-size: 1.1rem; font-weight: 600; cursor: pointer;
    }
  </style>
</head>
<body>

  <header class="site-header">
    <div class="header-container">
      <div class="logo">
        <a href="index.html"><img src="Hình/LOGO/LOGO.png" alt="Logo"></a>
      </div>
      <div class="search-box" role="search">
        <i class="fa-solid fa-magnifying-glass search-icon"></i>
        <input class="search-input" type="search" placeholder="Tìm sản phẩm, thương hiệu...">
      </div>
      <div class="header-right">
        <a href="cart.html" class="cart-btn">
          <img class="cart-icon" src="Hình/CART/shopping-cart-304843_1280.webp" alt="Giỏ hàng">
          <span class="cart-badge" id="cartCount" style="display:none">0</span>
        </a>
        <div id="userSection"></div>
      </div>
      <nav class="main-menu">
        <ul>
          <li><a href="index.html">TRANG CHỦ</a></li>
          <li><a href="Introduce.html">GIỚI THIỆU</a></li>
          <li class="brand-menu">
            <a href="store.html">CỬA HÀNG</a>
            <ul class="submenu">
              <li><a href="mypham.html">Mỹ phẩm</a></li>
              <li><a href="thoitrang.html">Thời trang</a></li>
            </ul>
          </li>
          <li><a href="livestream.html">TRANG LIVESTREAM</a></li>
          <li><a href="hopthoai.html">HỘP THOẠI</a></li>
          <li><a href="thongbao.html">THÔNG BÁO</a></li>
        </ul>
      </nav>
    </div>
  </header>

<main>
    <section class="checkout-section address-section">
        <div class="address-header"><h2>Địa Chỉ Nhận Hàng</h2><button class="change-btn">Thay Đổi</button></div>
        <div class="address-details">
            <p><strong><span id="checkout-fullname"></span> (<span id="checkout-phone"></span>)</strong></p>
            <p id="checkout-address"></p>
        </div>
    </section>

    <section class="checkout-section">
        <div class="products-header">
            <div>Sản phẩm</div>
            <div class="text-center">Đơn giá</div>
            <div class="text-center">Số lượng</div>
            <div class="text-right">Thành tiền</div>
        </div>
        <div class="product-list" id="order-items"></div>
    </section>
    
    <section class="checkout-section">
        <h2 class="section-title">Phương thức thanh toán</h2>
        <div class="payment-options">
            <div class="payment-option active" data-payment="cod">Thanh toán khi nhận hàng</div>
            <div class="payment-option" data-payment="momo">Ví MoMo</div>
            <div class="payment-option" data-payment="bank">Thẻ Tín dụng/Ghi nợ</div>
        </div>
    </section>

    <section class="checkout-section">
        <div class="order-options">
            <div class="option-line">
                <div class="label">TikTok Trendy Shop Voucher</div>
                <div class="action">Miễn phí vận chuyển</div>
            </div>
            <div class="option-line">
                <div class="label">Phương thức vận chuyển</div>
                <div class="value">Nhanh - <span class="free-shipping">30.000</span></div>
            </div>
        </div>
        <div class="summary-section">
            <div class="summary-line">
                <div class="label">Tiền sản phẩm</div>
                <div class="value" id="summary-subtotal">0₫</div>
            </div>
            <div class="summary-line">
                <div class="label">Tiền vận chuyển</div>
                <div class="value" id="summary-shipping">0₫</div>
            </div>
            <div class="summary-line">
                <div class="label">Giảm giá vận chuyển</div>
                <div class="value" id="summary-shipping-discount">-0₫</div>
            </div>
        </div>
        <div class="place-order-section">
            <div class="total-payable">
                <span class="label">Tổng thanh toán:</span>
                <span class="value" id="summary-payable">0₫</span>
            </div>
            <button class="place-order-btn" id="place-order-btn">Đặt Hàng</button>
        </div>
    </section>
</main>

<footer>
    <div class="footer-container" style="background-color: #000000; color: #ffffff; padding: 20px; display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; text-align: center;">
      <div class="footer-logo">
        <img src="Hình/LOGO/LOGO.png" alt="TikTok Trendy Shop" style="height: 100px; margin-bottom: 10px;">
      </div>
      <div class="footer-info">
        <h3 style="margin: 0 0 10px;">THÔNG TIN LIÊN HỆ</h3>
        <p>TikTok Trendy Shop</p>
        <p>Địa chỉ: Khu phố 6, phường Linh Trung, TP Thủ Đức, TP Hồ Chí Minh</p>
        <p>Email: tiktoktrendyshop@gmail.com</p>
      </div>
      <div class="footer-license">
        <h3 style="margin: 0 0 10px;">HỒ TRỢ KHÁCH HÀNG</h3>
        <p>Chăm sóc khách hàng</p>
        <p>Hướng dẫn mua hàng</p>
        <p>Hỗ trợ đổi trả hàng</p>
      </div>
      <div class="footer-payment">
        <h3 style="margin: 0 0 10px;">CHÍNH SÁCH</h3>
        <p>Chính sách đổi hàng</p>
        <p>Bảo mật thông tin</p>
        <p>Chính sách giao hàng</p>
      </div>
    </div>
  </footer>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const orderItemsEl = document.getElementById("order-items");
  const summarySubtotalEl = document.getElementById("summary-subtotal");
  const summaryShippingEl = document.getElementById("summary-shipping");
  const summaryShippingDiscountEl = document.getElementById("summary-shipping-discount");
  const summaryPayableEl = document.getElementById("summary-payable");

  const SHIPPING_FEE = 30000;
  
  const user = JSON.parse(localStorage.getItem("user")) || {};
  document.getElementById("checkout-fullname").textContent = user.fullname || "Vui lòng cập nhật tên";
  document.getElementById("checkout-phone").textContent = user.phone || "0123456789";
  document.getElementById("checkout-address").textContent = user.address || "Cổng A, Trường Đại học Công nghệ thông tin - ĐHQG TPHCM, đường Hàn Thuyên, khu phố 6, phường Linh Trung, TP Thủ Đức, TP Hồ Chí Minh";

  function loadOrder() {
    const buyNowItem = JSON.parse(localStorage.getItem("buyNow"));
    const cartItems = JSON.parse(localStorage.getItem("cart")) || [];
    const loggedInUser = JSON.parse(localStorage.getItem("user")) || null;

    const userCart = loggedInUser ? cartItems.filter(item => item.username === loggedInUser.fullname) : [];
    const items = buyNowItem ? [buyNowItem] : userCart;

    orderItemsEl.innerHTML = "";
    let subtotal = 0;

    if (items.length === 0) {
      orderItemsEl.innerHTML = "<p style='text-align:center; padding: 20px;'>Không có sản phẩm nào để thanh toán.</p>";
      summarySubtotalEl.textContent = "0₫";
      summaryShippingEl.textContent = "0₫";
      summaryShippingDiscountEl.textContent = "-0₫";
      summaryPayableEl.textContent = "0₫";
      return;
    }

    items.forEach(item => {
      const quantity = parseInt(item.quantity) || 1;
      const price = parseFloat(item.price) || 0;
      const itemTotal = price * quantity;
      subtotal += itemTotal;

      const itemEl = document.createElement("div");
      itemEl.className = "product-item";
      itemEl.innerHTML = `
        <div class="product-info">
          <img src="${item.image}" alt="${item.name}">
          <div><div class="name">${item.name}</div><div class="classification">Phân loại: ${item.size || 'N/A'}</div></div>
        </div>
        <div class="text-center">${price.toLocaleString('vi-VN')}₫</div>
        <div class="text-center">${quantity}</div>
        <div class="text-right">${itemTotal.toLocaleString('vi-VN')}₫</div>
      `;
      orderItemsEl.appendChild(itemEl);
    });

    const voucherDiscount = SHIPPING_FEE; // Tự động áp voucher free ship
    const totalPayable = subtotal;

    summarySubtotalEl.textContent = `${subtotal.toLocaleString('vi-VN')}₫`;
    summaryShippingEl.textContent = `${SHIPPING_FEE.toLocaleString('vi-VN')}₫`;
    summaryShippingDiscountEl.textContent = `-${voucherDiscount.toLocaleString('vi-VN')}₫`;
    summaryPayableEl.textContent = `${totalPayable.toLocaleString('vi-VN')}₫`;
  }

  document.getElementById("place-order-btn").addEventListener("click", () => {
    const user = JSON.parse(localStorage.getItem("user"));
    if (!user) { alert("Vui lòng đăng nhập để đặt hàng!"); return; }
    alert("Đặt hàng thành công! Cảm ơn bạn đã mua sắm.");
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    cart = cart.filter(item => item.username !== user.fullname);
    localStorage.setItem("cart", JSON.stringify(cart));
    localStorage.removeItem("buyNow");
    window.location.href = "index.html";
  });
  
  // Xử lý click cho các phương thức thanh toán
  const paymentOptions = document.querySelectorAll('.payment-option');
  paymentOptions.forEach(option => {
      option.addEventListener('click', () => {
          paymentOptions.forEach(opt => opt.classList.remove('active'));
          option.classList.add('active');
      });
  });

  loadOrder();
});
</script>

</body>
</html>
